# MySQL面试题整理.md

## sql相关
**问题：char、varchar的区别是什么？**

varchar是变长而char的长度是固定的。如果你的内容是固定大小的，你会得到更好的性能。

**问题： TRUNCATE和DELETE的区别是什么？**

DELETE命令从一个表中删除某一行，或多行，TRUNCATE命令永久地从表中删除每一行。



**问题：FLOAT和DOUBLE的区别是什么？**

FLOAT类型数据可以存储至多8位十进制数，并在内存中占4字节。

DOUBLE类型数据可以存储至多18位十进制数，并在内存中占8字节。

**问题：如何在MySQL种获取当前日期？**
```
SELECT CURRENT_DATE();
```
**问题：如何查询第n高的工资？**
```
SELECT DISTINCT(salary) from employee ORDER BY salary DESC LIMIT n-1,1
```
**问题：varchar(50)中50的含义**

最多存放50个字符，varchar(50)和(200)存储hello所占空间一样，但后者在排序时会消耗更多内存，因为order by col采用fixed_length计算col长度(memory引擎也一样)。

**问题：int(20)中20的含义**

是指显示字符的长度，不影响内部存储，只是当定义了ZEROFILL时，前面补多少个 0

**问题：请写出下面MySQL数据类型表达的意义（int(0)、char(16)、varchar(16)、datetime、text）**

- int(0)表示数据是INT类型，长度是0

- char(16)表示固定长度字符串，长度为16

- varchar(16)表示可变长度字符串，长度为16

- datetime表示时间类型

- text表示字符串类型，能存储大字符串，最多存储65535字节数据）

> 扩展：SQL 数据类型
1. 整数类型

    包括TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT，分别表示1字节、2字节、3字节、4字节、8字节整数。任何整数类型都可以加上UNSIGNED属性，表示数据是无符号的，即非负整数。 长度：整数类型可以被指定长度，例如：INT(11)表示长度为11的INT类型。长度在大多数场景是没有意义的，它不会限制值的合法范围，只会影响显示字符的个数，而且需要和UNSIGNED ZEROFILL属性配合使用才有意义。例子，假定类型设定为INT(5)，属性为UNSIGNED ZEROFILL，如果用户插入的数据为12的话，那么数据库实际存储数据为00012。

2. 实数类型

    包括FLOAT、DOUBLE、DECIMAL。DECIMAL可以用于存储比BIGINT还大的整型，能存储精确的小数。而FLOAT和DOUBLE是有取值范围的，并支持使用标准的浮点进行近似计算。计算时FLOAT和DOUBLE相比DECIMAL效率更高一些，DECIMAL你可以理解成是用字符串进行处理。

3. 字符串类型

    包括VARCHAR、CHAR、TEXT、BLOBVARCHAR用于存储可变长字符串，它比定长类型更节省空间。VARCHAR使用额外1或2个字节存储字符串长度。列长度小于255字节时，使用1字节表示，否则使用2字节表示。VARCHAR存储的内容超出设置的长度时，内容会被截断。CHAR是定长的，根据定义的字符串长度分配足够的空间。CHAR会根据需要使用空格进行填充方便比较。CHAR适合存储很短的字符串，或者所有值都接近同一个长度。CHAR存储的内容超出设置的长度时，内容同样会被截断。

    > 使用策略：对于经常变更的数据来说，CHAR比VARCHAR更好，因为CHAR不容易产生碎片。

    > 对于非常短的列，CHAR比VARCHAR在存储空间上更有效率。

    > 使用时要注意只分配需要的空间，更长的列排序时会消耗更多内存。尽量避免使用TEXT/BLOB类型，查询时会使用临时表，导致严重的性能开销。

4. 枚举类型（ENUM）

    把不重复的数据存储为一个预定义的集合。有时可以使用ENUM代替常用的字符串类型。ENUM存储非常紧凑，会把列表值压缩到一个或两个字节。ENUM在内部存储时，其实存的是整数。尽量避免使用数字作为ENUM枚举的常量，因为容易混乱。排序是按照内部存储的整数

5. 日期和时间类型

    尽量使用timestamp，空间效率高于datetime，用整数保存时间戳通常不方便处理。如果需要存储微妙，可以使用bigint存储。
**问题：请说明varchar和text的区别**

- varchar可指定字符数，text不能指定，内部存储varchar是存入的实际字符数+1个字节（n<=255）或2个字节(n>255)，text是实际字符数+2个字节。

- text类型不能有默认值。

- varchar可直接创建索引，text创建索引要指定前多少个字符。varchar查询速度快于text,在都创建索引的情况下，text的索引几乎不起作用。

- 查询text需要创建临时表。

**问题：有A(id,sex,par,c1,c2),B(id,age,c1,c2)两张表，其中A.id与B.id关联，现在要求写出一条SQL语句，将B中age>50的记录的c1,c2更新到A表中同一记录中的c1,c2字段中**
```
UPDATE A,B SET A.c1 = B.c1, A.c2 = B.c2 WHERE A.id = B.id
UPDATE A INNER JOIN B ON A.id=B.id SET A.c1 = B.c1,A.c2=B.c2

#再加上B中age>50的条件：
UPDATE A,B set A.c1 = B.c1, A.c2 = B.c2 WHERE A.id = B.id and B.age > 50;
UPDATE A INNER JOIN B ON A.id = B.id set A.c1 = B.c1,A.c2 = B.c2 WHERE B.age > 50
```

**问题：简单说一说drop、delete与truncate的区别**

SQL中的drop、delete、truncate都表示删除，但是三者有一些差别

- delete和truncate只删除表的数据不删除表的结构
- 速度,一般来说: drop> truncate >delete 
- delete语句是dml,这个操作会放到rollback segement中,事务提交之后才生效;如果有相应的trigger,执行的时候将被触发。 truncate,drop是ddl, 操作立即生效,原数据不放到rollback segment中,不能回滚. 操作不触发trigger. 


**问题：drop、delete与truncate分别在什么场景之下使用？**

- 不再需要一张表的时候，用drop
- 想删除部分数据行时候，用delete，并且带上where子句
- 保留表而删除所有数据的时候用truncate
**问题： 超键、候选键、主键、外键分别是什么？**

- 超键：在关系中能唯一标识元组的属性集称为关系模式的超键。一个属性可以为作为一个超键，多个属性组合在一起也可以作为一个超键。超键包含候选键和主键。

- 候选键：是最小超键，即没有冗余元素的超键。

- 主键：数据库表中对储存数据对象予以唯一和完整标识的数据列或属性的组合。一个数据列只能有一个主键，且主键的取值不能缺失，即不能为空值（Null）。

- 外键：在一个表中存在的另一个表的主键称此表的外键。

**问题：什么是视图？以及视图的使用场景有哪些？**

视图是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增，改，查，操作。视图通常是有一个表或者多个表的行或列的子集。对视图的修改不影响基本表。它使得我们获取数据更容易，相比多表查询。

- 只暴露部分字段给访问者，所以就建一个虚表，就是视图。
- 查询的数据来源于不同的表，而查询者希望以统一的方式查询，这样也可以建立一个视图，把多个表查- 询结果联合起来，查询者只需要直接从视图中获取数据，不必考虑数据来源于不同表所带来的差异

## 存储相关

### 存储引擎
1. InnoDB存储引擎

- 默认事务型引擎，最重要最广泛的存储引擎，性能非常优秀。

- 数据存储在共享表空间，可以通过配置分开。也就是多个表和索引都存储在一个表空间中，可以通过配置文件改变此配置。

- 对主键查询的性能高于其他类型的存储引擎。

- 内部做了很多优化，从磁盘读取数据时会自动构建hash索引，插入数据时自动构建插入缓冲区。

- 通过一些机制和工具支持真正的热备份。

- 支持崩溃后的安全恢复。

- 支持行级锁。

- 支持外键。

2. MyISAM存储引擎

- 拥有全文索引、压缩、空间函数。

- 不支持事务和行级锁、不支持崩溃后的安全恢复。

- 表存储在两个文件，MYD和MYI。

- 设计简单，某些场景下性能很好，例如获取整个表有多少条数据，性能很高。

- 全文索引不是很常用，不如使用外部的ElasticSearch或Lucene。

3. 其他表引擎Archive、Blackhole、CSV、Memory

> 使用策略在大多数场景下建议使用InnoDB存储引擎。
4. 请列举3个以上表引擎

InnoDB、MyISAM、Memory

5. 请说明InnoDB和MyISAM的区别

- InnoDB支持事务，MyISAM不支持；

- InnoDB数据存储在共享表空间，MyISAM数据存储在文件中；

- InnoDB支持行级锁，MyISAM只支持表锁；

- InnoDB支持崩溃后的恢复，MyISAM不支持；

- InnoDB支持外键，MyISAM不支持；

- InnoDB不支持全文索引，MyISAM支持全文索引；

6. innodb引擎的特性

- 插入缓冲（insert buffer)

- 二次写(double write)

- 自适应哈希索引(ahi)

- 预读(read ahead)

### 存储过程


1. 什么是存储过程：

存储过程可以说是一个记录集吧，它是由一些T-SQL语句组成的代码块，这些T-SQL语句代码像一个方法一样实现一些功能（对单表或多表的增删改查），然后再给这个代码块取一个名字，在用到这个功能的时候调用他就行了。

2. 存储过程的好处：

- 由于数据库执行动作时，是先编译后执行的。然而存储过程是一个编译过的代码块，所以执行效率要比T-SQL语句高。

- 一个存储过程在程序在网络中交互时可以替代大堆的T-SQL语句，所以也能降低网络的通信量，提高通信速率。

- 通过存储过程能够使没有权限的用户在控制之下间接地存取数据库，从而确保数据的安全。


**问题： MySQL存储过程**
- 为以后的使用保存的一条或多条MySQL语句的集合，因此也可以在存储过程中加入业务逻辑和流程。

- 可以在存储过程中创建表，更新数据，删除数据等等。

使用策略:

- 可以通过把SQL语句封装在容易使用的单元中，简化复杂的操作

- 可以保证数据的一致性

- 可以简化对变动的管理


## 索引相关
**问题：简单描述MySQL中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响？**

参考[MySQL索引](MySQL索引.md)

**问题：：创建MySQL联合索引应该注意什么？**

需遵循前缀原则

**问题：列值为NULL时，查询是否会用到索引？**

在MySQL里NULL值的列也是走索引的。当然，如果计划对列进行索引，就要尽量避免把它设置为可空，MySQL难以优化引用了可空列的查询,它会使索引、索引统计和值更加复杂。

**问题：以下语句是否会应用索引：`SELECT FROM users WHERE YEAR(adddate) < 2007`;**

不会，因为只要列涉及到运算，MySQL就不会使用索引。

**问题：MyISAM索引实现？**

MyISAM存储引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。MyISAM的索引方式也叫做非聚簇索引的，之所以这么称呼是为了与InnoDB的聚簇索引区分。

**问题：MyISAM索引与InnoDB索引的区别？**

- InnoDB索引是聚簇索引，MyISAM索引是非聚簇索引。

- InnoDB的主键索引的叶子节点存储着行数据，因此主键索引非常高效。

- MyISAM索引的叶子节点存储的是行数据地址，需要再寻址一次才能得到数据。

- InnoDB非主键索引的叶子节点存储的是主键和其他带索引的列数据，因此查询时做到覆盖索引会非常高效。

**问题：以下三条sql 如何建索引，只建一条怎么建？**
```
WHERE a=1 AND b=1
WHERE b=1
WHERE b=1 ORDER BY time DESC
```
以顺序b,a,time建立联合索引，`CREATE INDEX table1_b_a_time ON index_test01(b,a,time)`。因为最新MySQL版本会优化WHERE子句后面的列顺序，以匹配联合索引顺序。
## 性能相关

## 海量数据处理相关

## 安全性相关
## 存储相关

## MySQL操作相关

**MySQL的连接和关闭：mysql -u -p -h -P**
- -u：指定用户名
- -p：指定密码
- -h：主机
- -P：端口

**进入MySQL命令行后：G、c、q、s、h、d**
- G：打印结果垂直显示
- c：取消当前MySQL命令
- q：退出MySQL连接
- s：显示服务器状态
- h：帮助信息
- d：改变执行符

## MySQL锁机制
表锁是日常开发中的常见问题，因此也是面试当中最常见的考察点，当多个查询同一时刻进行数据修改时，就会产生并发控制的问题。共享锁和排他锁，就是读锁和写锁。

- 共享锁，不堵塞，多个用户可以同时读一个资源，互不干扰。

- 排他锁，一个写锁会阻塞其他的读锁和写锁，这样可以只允许一个用户进行写入，防止其他用户读取正在写入的资源。

### 锁的粒度
- 表锁，系统开销最小，会锁定整张表，MyIsam使用表锁。

- 行锁，最大程度的支持并发处理，但是也带来了最大的锁开销，InnoDB使用行锁。

## MySQL事务处理


MySQL提供事务处理的表引擎，也就是InnoDB。

服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种引擎是不靠谱的。

> 需要注意，在非事务表上执行事务操作，MySQL不会发出提醒，也不会报错。
### 事务
事务（Transaction）是并发控制的基本单位。所谓的事务，它是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。事务是数据库维护数据一致性的单位，在每个事务结束时，都能保持数据一致性。

事务具有以下4个属性：

- Atomic（原子性）：事务中包含的操作被看做一个逻辑单元，这个逻辑单元中的操作要么全部成功，要么全部失败。

- Consistency（一致性）：只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。

- Isolation（隔离性）：事务允许多个用户对同一个数据进行并发访问，而不破坏数据的正确性和完整性。同时，并行事务的修改必须与其他并行事务的修改相互独立。

- Durability（持久性）：事务结束后，事务处理的结果必须能够得到固化。

事务的四个隔离级别为：

- read uncommited ：读到未提交数据
- read committed：脏读，不可重复读
- repeatable read：可重读
- serializable ：串行事物

事务的语句：
- 开始事物：BEGIN TRANSACTION
- 提交事物：COMMIT TRANSACTION
- 回滚事务：ROLLBACK TRANSACTION
## MySQL触发器
**问题：什么是触发器，MySQL中都有哪些触发器？**

触发器是指一段代码，当触发某个事件时，自动执行这些代码。在MySQL数据库中有如下六种触发器：

- Before Insert

- After Insert

- Before Update

- After Update

- Before Delete

- After Delete
## 数据库范式

- 第一范式（1NF）：数据库表中的字段都是单一属性的，不可再分。这个单一属性由基本类型构成，包括整型、实数、字符型、逻辑型、日期型等。

- 第二范式（2NF）：数据库表中不存在非关键字段对任一候选关键字段的部分函数依赖（部分函数依赖指的是存在组合关键字中的某些字段决定非关键字段的情况），也即所有非关键字段都完全依赖于任意一组候选关键字。 
- 第三范式（3NF）：在第二范式的基础上，数据表中如果不存在非关键字段对任一候选关键字段的传递函数依赖则符合第三范式。所谓传递函数依赖，指的是如 果存在"A → B → C"的决定关系，则C传递函数依赖于A。因此，满足第三范式的数据库表应该不存在如下依赖关系： 关键字段 → 非关键字段 x → 非关键字段y
## 数据库的乐观锁和悲观锁是什么？

数据库管理系统（DBMS）中的并发控制的任务是确保在多个事务同时存取数据库中同一数据时不破坏事务的隔离性和统一性以及数据库的统一性。

乐观并发控制(乐观锁)和悲观并发控制（悲观锁）是并发控制主要采用的技术手段。

- 悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作
- 乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。

## 数据库备份
### MySQL几种备份方式
1. 逻辑备份：使用mysql自带的mysqldump工具进行备份。备份成sql文件形式。 

- 优点：最大好处是能够与正在运行的mysql自动协同工作，在运行期间可以确保备份是当时的点，它会自动将对应操作的表锁定，不允许其他用户修改(只能访问)。可能会阻止修改操作。sql文件通用方便移植。 
- 缺点：备份的速度比较慢。如果是数据量很多的时候。就很耗时间。如果数据库服务器处在提供给用户服务状态，在这段长时间操作过程中，意味着要锁定表(一般是读锁定，只能读不能写入数据)。那么服务就会影响的。 

2. 物理备份：直接拷贝mysql的数据目录。 

- 直接拷贝只适用于myisam类型的表。这种类型的表是与机器独立的。但实际情况是，你设计数据库的时候不可能全部使用myisam类型表。你也不可能因为myisam类型表与机器独立，方便移植，于是就选择这种表，这并不是选择它的理由。 
- 缺点：你不能去操作正在运行的mysql服务器(在拷贝的过程中有用户通过应用程序访问更新数据，这样就无法备份当时的数据)可能无法移植到其他机器上去。 

3. 双机热备份。
- mysql数据库没有增量备份的机制。当数据量太大的时候备份是一个很大的问题。还好mysql数据库提供了一种主从备份的机制(也就是双机热备) 
- 优点：适合数据量大的时候。现在明白了。大的互联网公司对于mysql数据备份，都是采用热机备份。搭建多台数据库服务器，进行主从复制。

### 数据库不能停机，请问如何备份? 如何进行全备份和增量备份?
可以使用逻辑备份和双机热备份: 
- 完全备份：完整备份一般一段时间进行一次，且在网站访问量最小的时候，这样常借助批处理文件定时备份。主要是写一个批处理文件在里面写上处理程序的绝对路径然后把要处理的东西写在后面，即完全备份数据库。 
- 增量备份：对ddl和dml语句进行二进制备份。且5.0无法增量备份，5.1后可以。如果要实现增量备份需要在my.ini文件中配置备份路径即可，重启mysql服务器，增量备份就启动了。
