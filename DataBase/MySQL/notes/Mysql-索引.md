# Mysql-索引

##  索引简介
### 是什么
- MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。 可以得到索引的本质：索引是数据结构。

- 可以简单理解为“排好序的快速查找数据结构”。

- 详解

    在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。
### 索引做了些什么可以让我们查询加快速度呢？

其实就是将无序的数据变成有序(相对)。

其实底层结构就是B+树，B+树作为树的一种实现，能够让我们很快地查找出对应的记录。

#### B+Tree
B+Tree是平衡树的一种。

> 平衡树：它是一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。
## 索引分类
- 普通索引：最基本的索引，没有任何限制
- 唯一索引：与"普通索引"类似，不同的就是：索引列的值必须唯一，但允许有空值。
- 主键索引（聚簇索引）：它是一种特殊的唯一索引，不允许有空值。 
- 全文索引：仅可用于 MyISAM 表，针对较大的数据，生成全文索引很耗时好空间。
- 组合索引：即一个索引包含多个列。为了更多的提高mysql效率可建立组合索引，遵循”最左前缀“原则。
- 覆盖索引:查询列要被所使用的索引覆盖

### 覆盖索引
- 解释一： 就是select的数据列只用从索引中就能够取得，不必从数据表中读取，换句话说查询列要被所使用的索引覆盖。
- 解释二： 索引是高效找到行的一个方法，当能通过检索索引就可以读取想要的数据，那就不需要再到数据表中读取行了。如果一个索引包含了（或覆盖了）满足查询语句中字段与条件的数据就叫做覆盖索引。
- 解释三：是非聚集组合索引的一种形式，它包括在查询里的Select、Join和Where子句用到的所有列（即建立索引的字段正好是覆盖查询语句[select子句]与查询条件[Where子句]中所涉及的字段，也即，索引包含了查询正在查找的所有数据）。

> 即从辅助索引中就可以得到查询的记录，而不需要查询聚集索引中的记录。

简单说就是，select 到 from 之间查询的列 <=使用的索引列+主键

使用覆盖索引的好吃是辅助索引不饱含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少大量的IO操作。
### 聚簇索引与非聚簇索引
聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。

术语‘聚簇’表示数据行和相邻的键值聚簇的存储在一起。

**简单概括：**

- 聚集索引就是以主键创建的索引

- 非聚集索引就是以非主键创建的索引

**区别：**

- 聚集索引在叶子节点存储的是表中的数据

- 非聚集索引在叶子节点存储的是主键和索引列

- 使用非聚集索引查询出数据时，拿到叶子上的主键再去查到想要查找的数据。(拿到主键再查找这个过程叫做回表)
 
**聚簇索引的好处：**

- 按照聚簇索引排列顺序，查询显示一定范围数据的时候，由于数据都是紧密相连，数据库不不用从多个数据块中提取数据，所以节省了大量的io操作。

**聚簇索引的限制：**

- 对于mysql数据库目前只有innodb数据引擎支持聚簇索引，而Myisam并不支持聚簇索引。
- 由于数据物理存储排序方式只能有一种，所以每个Mysql的表只能有一个聚簇索引。一般情况下就是该表的主键。
- 为了充分利用聚簇索引的聚簇的特性，所以innodb表的主键列尽量选用有序的顺序id，而不建议用无序的id，比如uuid这种。
## 索引最左匹配原则
- 索引可以简单如一个列(a)，也可以复杂如多个列(a, b, c, d)，即联合索引。

- 如果是联合索引，那么key也由多个列组成，同时，索引只能用于查找key是否存在（相等），遇到范围查询(>、<、between、like左匹配)等就不能进一步匹配了，后续退化为线性查找。

- 因此，列的排列顺序决定了可命中索引的列数

## 回表
先索引扫描，再通过ID去取索引中未能提供的数据，即为回表

回表就是先通过数据库索引扫描出数据所在的行，再通过行主键id取出索引中未提供的数据，即基于非主键索引的查询需要多扫描一棵索引树。

因此，可以通过索引先查询出id字段，再通过主键id字段，查询行中的字段数据，即通过再次查询提供MySQL查询速度。