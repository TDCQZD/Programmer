# 高质量的代码

## 面试官谈代码质量

1.代码容错处理能力，异常处理、资源回收
2.最不能容忍功能性错误，忽略边界情况。
3.变量、函数命名规范；解决一个具体问题需要一个最合适的数据结构
4.从程序的正确性和鲁棒性两方面检验代码的质量。会关注对输入参数的检查、处理错误和异常的方式、命名方式等。

## 代码的规范性
如图所示,书写、布局和命名都决定着代码的规范性。

![](./images/3.1.png)

首先，规范的代码节写清晰。绝大部分面试都是要求应聘者在白纸上书写。虽然应聘者没有必要为了面试特意去练字，但在面试过程中减慢写字的速度，尽量把每个字母写清楚还是很有必要的。不用担心没有时间去写代码，通常编程面试的代码量都不会超过50行，书写不用花多少时间，关键是在写代码之前形成清晰的思路并能把思路用编程语言清楚地书写出来。

其次，规范的代码布局清晰。。离开了工具手写代码时，我们就要格外注意布局问题。当循环、判断较多，逻辑较复杂时，缩进的层次可能会比较多。如果布局不够清晰，缩进也不能体现代码的逻辑，面试官面对这样的代码将会头晕脑胀。

最后，规范的代码命名合理。强烈建议应聘者在写代码的时候，用完整的英文单词组合命名变量和函数，比如函数需要传入一个二叉树的根结点作为参数，则可以把该参数命名为BinaryTreeNode*pRoot,不要因为这样会多写几个字母而觉得麻烦。如果一眼能看出变量、函数的用途，应聘者就能避免自己搞混淆而犯一些低级的错误。同时合理的命名也能让面试官一眼就能读懂代码的意图。而不是让他去猜变量m到底是数组中的最大值还是最小值。

>面试小提示：应聘者在写代码的时候，最好用完整的英文单词组合命名变量和函数，以便面试官能一眼读懂代码的意图。

## 代码的完整性
在面试的过程中，面试官会非常关注应聘者考虑问题是否周全。面试官通过检査代码是否完整來考査应聘者的思维是否全面。通常面试官会检査应聘者的代码是否完成了基本功能、输入边界值是否能得到正确的输出、是否对各种不合规范的非法输入做出了合理的错误处理。

### 从3方面确保代码的完整性
应聘者在写代码之前，首先要把可能的输入都想清楚，从而避免在程序中出现各种各样的质fi漏洞。也就是说在编码之前要考虑单元测试。如果能够设计全面的单元测试用例并在代码中体现出来，那么写出的代码自然也就是完整正确的了。通常我们可以从功能测试、边界测试和负面测试三方面设计测试用例，以确保代码的完整性（如图3.2所示)。

![](./images/3.2.png)

首先要考虑的是普通功能测试的测试用例.我们首先要保证写出的代码能够完成面试官要求的基本功能.比如面试题要求完成的功能是把字符串转换成整数，我们就可以考虑输入字符串”123"來测试自己写的代码。这里要把零、正数和负数都考虑进去。

考虑功能测试的时候，我们要尽量突破常规思维的限制.面试的时候我们经常受到惯性思维的限制，从而看不到更多的功能需求。比如面试题12“打印1到最大的n位数”,很多人觉衔这题很简单。最大的3位数是999、最大的4位数是9999,这些数字很容易就能算出来。但是最大的n位数都能用int型表示吗？超出int的范围我们可以考虑longlong类型.超出longlong能够表示的范围呢？面试官是不是要求考虑任意大的数字？如果面试官确认题目要求的是任意大的数字，那么这个题目就是一个大数问题.此时我们需要特殊的数据结构来表示数字，比如用字符串或者数组来表示大的数字，以确保不会溢出。

其次需要考虑各种边界值的测试用例.很多时候我们的代码中都会有循环或者递归.如果我们的代码是基于循环，那么结束循环的边界条件是否正确？如果是递归,递归终止的边界值是否正确？这些都是边界测试时耍考虑的用例.还是以字符串转换成稂数的问题为例.我们写出的代码应该确保能够正确转换最大的正整数数和最小的负整数。

最后还需要考虑各种肯的错误的输入，也就是通常所说的负面测试的测试用例.我们写出的函数除了要顺利地完成要求的功能之外.当输入不符合要求的时候还能做出合理的错误处理。在设计把字符串转換成整数的函数的时候,我们就要考虑当输入的字符中不是一个数字，比如“1a2b3c”,我们怎么告诉的数的调用者这个输入是非法的.

前面我们说的都圮要全面考虑当前葙求对应的各种可能输入.在软件开发过程中，永远不变的就是需求会一直改变.如果我们在面试的时候写出的代码能够把将來需求可能的变化都考虑进去，在需求发生变化的时候能够尽量减少代码改动的风险，那我们就向面试官展示了自己对程序可扩展性和可维护性的理解，通过面试就是水到渠成的亊情了.

### 3种错误处理方法

通常我们有3种方式把错误信息传递给函数的调用者，第一种方式是函数用返回值来告知调用者是否出错，比如很多Windows的API就是这个类型。Windows中很多API的返回值为0表示API调用成功，而返回位不为0表示在API调用的过程中出错了。微软为不同的非零返回值定义了不同的意义.调用者可以根据这些返回值判断出错的原因。这种方式最大的问题是使用不便，因为函数不能直接把计算结果通过返回值赋值给其他变量，同时也不能把这个函数计算的结果直接作为参数传递给其他函数。

第二种方式是当发生错误时设凭一个全局变量。此时我们可以在返回值中传递计算结果了。这种方法比第一种方法使用起来更加方便，因为调用者可以立接把返回值赋值给其他变量或者作为参数传递给其他函数。Windows的很多API运行出错之后，也会设置一个全局变量。我们可以通过调用函数GetLastError分析个表示错误的全局变里，从而得知出错的原因。但这个方法有个问题：调用者很容易就会忘记去检查全局变量，因此在调用出错的时候忘记做相应的错误处理，从而留下安全隐患。

第三种方式是异常。当函数运行出错的时候，我们就抛出一个异常，我们还可以根据不同的出错原因定义不同的异常类型。因此函数的调用者根据异常的类型就能知道出错的原因，从而做相应的处理。另外，我们能显式划分程序正常运行的代码块（try模块）和处理异常的代码块（catch模块),逻辑比较清晰。异常在高级语言如C#中是强烈推荐的错误处理方式。但有些早期的语有比如C语言还不支持异常.另外，当抛出异常的时候，程序的执行会打乱正常的顺序，对程序的性能有很大的影响。

上述3种错误处理的方式各有其优缺点（如表3.1所示)。那么，面试的时候我们该采用哪种方式呢？这要看面试官的满求。在听到面试官的题目之后，我们要尽快分析出可能存在哪些非法的输入，并和面试官官论该如何处理这些非法输入。

![](./images/表3.1.png)

## 代码的鲁棒性

鲁棒是英文Robust的音译，有时也翻译成健壮性。所谓的鲁棒性是指程序能够判断输入是否合乎规范要求，并对不合要求的输入予以合理的处理。

容错性是鲁棒性的一个重要体现。不鲁棒的软件在发生异常事件的时候，比如用户输入错误的用户名、试图打开的文件不存在或者网络不能连接，就会出现不可预见的诡异行为，或者干脆整个软件崩溃。这样的软件对于用户而言，不亚于一场灾难。

由于鲁棒性对软件开发非常重要，面试官在招聘的时候对应聘者写出的代码是否鲁棒也非常关注。提高代码的鲁棒性的奋效途径是进行防御性编程。

防御性编程是一种编程习惯，是指预见在什么地方可能会出现问题，并为这些可能出现的问题制定处理方式，比如试图打开文件时发现文件不存在，我们可以提示用户检査文件名和路径；当服务器连接不上时，我们可以试图连接备用服务器等.这样当异常情况发生时，软件的行为也尽在我们的掌握之中，而不至于出现不可預见的事情。

在面试时，最简单也最实用的防御性编程就是在函数入口添加代码以验证用户输入是否符合要求。通常面试要求的是写一两个函数，我们需要格外关注这些函数的输入参数。如果输入的是一个指针，那指针是空指针怎么办？如果输入的是一个字符串，那么字符床的内容为空怎么办？如果能把这些问题都提前考虑到，并做相应的处理，那么面试官就会觉得我们有防御性编稈的习惯，能够写出鲁棒的软件。

当然并不是所有与鲁棒性相关的问题都只是检査输入的参数这么简单。我们看到问题的时候，要多问几个“如果不……那么……”这样的问题。比如面试题15“链表中倒数第k个结点”，这里隐含着一个条件就足链表中结点的个数大于k。我们就要问如果链表中的结点的数H不是大丁1个，那么代码会出什么问题？这样的思考方式能够帮助我们发现潜在的问题并提前解决问题。这比让面试官发现问题之后我们再去慌忙分析代码査找问题的根源要好得多。


**健壮性**

健壮性是指软件对于规范要求以外的输入情况的处理能力。


所谓健壮的系统是指对于规范要求以外的输入能够判断出这个输入不符合规范要求，并能有合理的处理方式。

另外健壮性有时也和容错性，可移植性，正确性有交叉的地方。

**鲁棒性**

鲁棒是Robust的音译，也就是健壮和强壮的意思。

鲁棒性（robustness）就是系统的健壮性。它是指一个程序中对可能导致程序崩溃的各种情况都充分考虑到，并且作相应的处理，在程序遇到异常情况时还能正常工作，而不至于死机。